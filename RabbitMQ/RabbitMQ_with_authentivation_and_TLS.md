–Ø–∫—â–æ —Ö–æ—á–µ—à –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ RabbitMQ –∑ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é —á–µ—Ä–µ–∑ –ª–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å** + **TLS (SSL)**, —Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:  

1. **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ RabbitMQ –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è TLS**  
2. **–°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –∫–ª—ñ—î–Ω—Ç–∞**  
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–∏ RabbitMQ —á–µ—Ä–µ–∑ Docker**  
4. **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Python-–∫–ª—ñ—î–Ω—Ç –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ TLS**

---

## üîπ 1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ TLS  

–°—Ç–≤–æ—Ä–∏–º–æ **–∫–æ—Ä–µ–Ω–µ–≤–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç (CA)** —Ç–∞ –ø—ñ–¥–ø–∏—à–µ–º–æ —Å–µ—Ä–≤–µ—Ä–Ω—ñ —ñ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏.  

```sh
mkdir -p certs && cd certs

# 1. –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ—Ä–µ–Ω–µ–≤–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç (CA)
openssl req -x509 -new -nodes -keyout ca.key -out ca.crt -days 365 -subj "/CN=MyCA"

# 2. –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
openssl genpkey -algorithm RSA -out server.key

# 3. –ó–∞–ø–∏—Ç –Ω–∞ –ø—ñ–¥–ø–∏—Å (CSR) –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
openssl req -new -key server.key -out server.csr -subj "/CN=rabbitmq"

# 4. –ü—ñ–¥–ø–∏—Å—É—î–º–æ —Å–µ—Ä–≤–µ—Ä–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∫–æ—Ä–µ–Ω–µ–≤–∏–º CA
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365
```

–¢–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä–∏–º–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç:

```sh
openssl genpkey -algorithm RSA -out client.key
openssl req -new -key client.key -out client.csr -subj "/CN=client"
openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 365
```

–¢–µ–ø–µ—Ä —É –Ω–∞—Å —î —Ñ–∞–π–ª–∏:  
- `ca.crt` (–∫–æ—Ä–µ–Ω–µ–≤–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)  
- `server.crt`, `server.key` (—Å–µ—Ä–≤–µ—Ä–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)  
- `client.crt`, `client.key` (–∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)  

---

## üîπ 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è RabbitMQ –¥–ª—è TLS  

–°—Ç–≤–æ—Ä–∏–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª **`rabbitmq.conf`**:  

```ini
# –í—ñ–¥–∫–ª—é—á–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –ø–æ—Ä—Ç, –≤–∫–ª—é—á–∞—î–º–æ TLS
listeners.tcp = none
listeners.ssl.default = 5671

# –í–∫–ª—é—á–∞—î–º–æ TLS
ssl_options.cacertfile = /etc/rabbitmq/ssl/ca.crt
ssl_options.certfile   = /etc/rabbitmq/ssl/server.crt
ssl_options.keyfile    = /etc/rabbitmq/ssl/server.key

# –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
ssl_options.verify = verify_peer
ssl_options.fail_if_no_peer_cert = true
```

---

## üîπ 3. –ó–∞–ø—É—Å–∫ RabbitMQ —á–µ—Ä–µ–∑ Docker  

–ö–æ–ø—ñ—é—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –≤ –ø–∞–ø–∫—É `certs/` —Ç–∞ –∑–∞–ø—É—Å–∫–∞—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```sh
docker run -d --name rabbitmq \
  -p 5671:5671 -p 15672:15672 \
  -e RABBITMQ_DEFAULT_USER=myuser \
  -e RABBITMQ_DEFAULT_PASS=mypassword \
  -v $PWD/certs:/etc/rabbitmq/ssl \
  -v $PWD/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \
  rabbitmq:3-management
```

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ RabbitMQ –ø—Ä–∞—Ü—é—î:

```sh
docker logs rabbitmq | grep "TLS"
```

---

## üîπ 4. Python-–∫–ª—ñ—î–Ω—Ç —ñ–∑ TLS —Ç–∞ –ª–æ–≥—ñ–Ω–æ–º/–ø–∞—Ä–æ–ª–µ–º  

### üîπ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏  
```sh
pip install pika
```

### üîπ Python-–∫–æ–¥ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è  

```python
import pika
import ssl

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SSL
context = ssl.create_default_context(cafile="certs/ca.crt")
context.load_cert_chain(certfile="certs/client.crt", keyfile="certs/client.key")

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è
credentials = pika.PlainCredentials("myuser", "mypassword")
params = pika.ConnectionParameters(
    host="your_server_ip",
    port=5671,
    credentials=credentials,
    ssl_options=pika.SSLOptions(context)
)

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
connection = pika.BlockingConnection(params)
channel = connection.channel()
channel.queue_declare(queue="test")

print("Connected to RabbitMQ with TLS and authentication!")
channel.basic_publish(exchange="", routing_key="test", body="Hello TLS!")
connection.close()
```

---

## üîπ 5. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏  
1. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ RabbitMQ —Å–ª—É—Ö–∞—î –ø–æ—Ä—Ç **5671**:  
   ```sh
   docker logs rabbitmq | grep "TLS"
   ```
2. –ó–∞–ø—É—Å—Ç–∏ Python-–∫–ª—ñ—î–Ω—Ç:  
   ```sh
   python client.py
   ```
3. –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑'—è–≤–∏–ª–æ—Å—è —É RabbitMQ (–≤ Web UI `http://your_server_ip:15672/` ‚Üí Queues ‚Üí `test`).

---

## üîπ –í–∏—Å–Ω–æ–≤–æ–∫  
‚úÖ RabbitMQ –ø—Ä–∞—Ü—é—î **–∑ TLS**  
‚úÖ –ö–ª—ñ—î–Ω—Ç –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è **–∑ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è–º**  
‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–ª–æ–≥—ñ–Ω —Ç–∞ –ø–∞—Ä–æ–ª—å** –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó  

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ **–ø—Ä–∏–º—É—Å–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞** –∞–±–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ **OAuth2 + TLS**, —Å–∫–∞–∂–∏ ‚Äì –ø–æ—è—Å–Ω—é –¥–∞–ª—ñ üöÄ


–©–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **TLS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –±–µ–∑ –ª–æ–≥—ñ–Ω–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è**, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ç–∞–∫—ñ –∫—Ä–æ–∫–∏:  

1. –ó–º—ñ–Ω–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é RabbitMQ, —â–æ–± –≤—ñ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞–≤ –∫–ª—ñ—î–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏**  
2. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤**  
3. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ RabbitMQ –±–µ–∑ –ª–æ–≥—ñ–Ω–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏**  

---

# üîπ 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è RabbitMQ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ TLS  

–°—Ç–≤–æ—Ä–∏ –∞–±–æ –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π —Ñ–∞–π–ª **`rabbitmq.conf`**:  

```ini
# –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤–∏—á–∞–π–Ω—ñ TCP-–∑'—î–¥–Ω–∞–Ω–Ω—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ, –∞–ª–µ –ø—ñ–¥–≤–∏—â—É—î –±–µ–∑–ø–µ–∫—É)
listeners.tcp = none
listeners.ssl.default = 5671

# –®–ª—è—Ö –¥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
ssl_options.cacertfile = /etc/rabbitmq/ssl/ca.crt
ssl_options.certfile   = /etc/rabbitmq/ssl/server.crt
ssl_options.keyfile    = /etc/rabbitmq/ssl/server.key

# –í–∫–ª—é—á–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
ssl_options.verify     = verify_peer
ssl_options.fail_if_no_peer_cert = true

# –í–∏–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∑–∞ –ø–∞—Ä–æ–ª–µ–º, –∑–∞–ª–∏—à–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ TLS
auth_mechanisms.1 = external
```

> **`auth_mechanisms.1 = external`** ‚Äî –æ–∑–Ω–∞—á–∞—î, —â–æ RabbitMQ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤** –∑–∞–º—ñ—Å—Ç—å –ª–æ–≥—ñ–Ω–∞/–ø–∞—Ä–æ–ª—è.

### üîπ 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ RabbitMQ  
–Ø–∫—â–æ RabbitMQ –ø—Ä–∞—Ü—é—î –≤ Docker, –≤–∏–∫–æ–Ω–∞–π –∫–æ–º–∞–Ω–¥—É:  

```sh
docker restart rabbitmq
```

---

# üîπ 3. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤  

–Ø–∫—â–æ —Ç–∏ –≤–∂–µ –º–∞—î—à **CA (–∫–æ—Ä–µ–Ω–µ–≤–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)**, —Ç–æ –º–æ–∂–µ—à –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ **–æ–∫—Ä–µ–º—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞**:

```sh
cd certs

# 1. –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–ª—é—á –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞
openssl genpkey -algorithm RSA -out client.key

# 2. –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –ø—ñ–¥–ø–∏—Å (CSR)
openssl req -new -key client.key -out client.csr -subj "/CN=client"

# 3. –ü—ñ–¥–ø–∏—Å—É—î–º–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –Ω–∞—à–∏–º CA
openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 365
```

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ —É –∫–ª—ñ—î–Ω—Ç–∞ –±—É–¥—É—Ç—å —Ñ–∞–π–ª–∏:  
- `client.crt` (—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∫–ª—ñ—î–Ω—Ç–∞)  
- `client.key` (–ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –∫–ª—ñ—î–Ω—Ç–∞)  
- `ca.crt` (–∫–æ—Ä–µ–Ω–µ–≤–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç CA)  

–¶—ñ —Ñ–∞–π–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ **–Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π**.

---

# üîπ 4. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ –±–µ–∑ –ª–æ–≥—ñ–Ω–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è  

–£ **Python** –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **pika** –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ RabbitMQ —á–µ—Ä–µ–∑ TLS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é:

```python
import pika
import ssl

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è TLS
context = ssl.create_default_context(cafile="/path/to/certs/ca.crt")
context.load_cert_chain(certfile="/path/to/certs/client.crt", keyfile="/path/to/certs/client.key")

# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (–±–µ–∑ –ª–æ–≥—ñ–Ω–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è)
params = pika.ConnectionParameters(
    host="your_server_ip",
    port=5671,
    ssl_options=pika.SSLOptions(context)
)

# –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑'—î–¥–Ω–∞–Ω–Ω—è
connection = pika.BlockingConnection(params)
channel = connection.channel()
channel.queue_declare(queue="test")

print("‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ RabbitMQ —á–µ—Ä–µ–∑ TLS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é!")
channel.basic_publish(exchange="", routing_key="test", body="Hello via TLS Auth!")
connection.close()
```

---

# üîπ 5. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è  

–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –∫–ª—ñ—î–Ω—Ç –¥—ñ–π—Å–Ω–æ **–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏**, –ø–æ–¥–∏–≤–∏—Å—å **–ª–æ–≥–∏ RabbitMQ**:  

```sh
docker logs rabbitmq | grep "TLS"
```

–£ –ª–æ–≥–∞—Ö –º–∞—î –±—É—Ç–∏ —â–æ—Å—å –ø–æ–¥—ñ–±–Ω–µ:  
```
TLS connection from 192.168.1.100:12345 accepted
```

---

# üîπ 6. –Ø–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –∫–ª—ñ—î–Ω—Ç—ñ–≤?  

### üìå –°–ø–æ—Å—ñ–± 1: –ö–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ **CN (Common Name)** —É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞—Ö  
RabbitMQ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **CN (Common Name)** –∑ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ —è–∫ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.  
–¢–æ–±—Ç–æ, —è–∫—â–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –º–∞—î:  

```sh
openssl req -new -key client.key -out client.csr -subj "/CN=client1"
```

–¢–æ RabbitMQ —Å—Ç–≤–æ—Ä–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `client1`.  
> –Ø–∫—â–æ —Ç—Ä–µ–±–∞ –¥–∞—Ç–∏ –π–æ–º—É –¥–æ—Å—Ç—É–ø –¥–æ —á–µ—Ä–≥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **policies** —Ç–∞ **permissions**.

### üìå –°–ø–æ—Å—ñ–± 2: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **Subject Alternative Name (SAN)**  
–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —ñ–º–µ–Ω–∞ –≤ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏, —â–æ–± RabbitMQ –º—ñ–≥ –ª–µ–≥–∫–æ —ó—Ö —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏.

---

# üîπ 7. –ß–∏ –º–æ–∂–Ω–∞ –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∫–ª—ñ—î–Ω—Ç—ñ–≤?
–¢–∞–∫! –ü—Ä–æ—Å—Ç–æ **–∑–≥–µ–Ω–µ—Ä—É–π –Ω–æ–≤—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `client2.crt`, `client2.key`) —Ç–∞ –ø–µ—Ä–µ–¥–∞–π —ó—Ö.

---

# ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫  
‚úî –¢–µ–ø–µ—Ä RabbitMQ **–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î –∫–ª—ñ—î–Ω—Ç—ñ–≤** —á–µ—Ä–µ–∑ TLS-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –±–µ–∑ –ª–æ–≥—ñ–Ω–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è.  
‚úî –ö–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ –º–∞—Ç–∏ **—Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç**.  
‚úî –¶–µ –∑–Ω–∞—á–Ω–æ **–±–µ–∑–ø–µ—á–Ω—ñ—à–µ**, –Ω—ñ–∂ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤.  

–Ø–∫—â–æ —î –ø–∏—Ç–∞–Ω–Ω—è ‚Äì –ø–∏—Ç–∞–π! üöÄüîí


–ö–æ–ª–∏ RabbitMQ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **TLS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é**, –≤—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–µ—Ä–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ **CN (Common Name)** —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ –∫–ª—ñ—î–Ω—Ç–∞. –ê–ª–µ **—Å–∞–º–µ –ø–æ —Å–æ–±—ñ —Ü–µ –Ω–µ –¥–∞—î –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ —á–µ—Ä–≥**.  

–©–æ–± –∫–ª—ñ—î–Ω—Ç –º—ñ–≥ **—á–∏—Ç–∞—Ç–∏ —Ç–∞ –ø–∏—Å–∞—Ç–∏ –≤ —á–µ—Ä–≥–∏**, –ø–æ—Ç—Ä—ñ–±–Ω–æ **–≤–∏–¥–∞—Ç–∏ –π–æ–º—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É**.

---

# üîπ 1. –î–æ–¥–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞  
–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —â–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∫–ª—ñ—î–Ω—Ç–∞ –º—ñ—Å—Ç–∏—Ç—å:  

```sh
openssl req -new -key client.key -out client.csr -subj "/CN=client1"
```

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ RabbitMQ —Å–ø—Ä–∏–π–º–∞—Ç–∏–º–µ —Ü—å–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `client1`.  
–ê–ª–µ **–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É –Ω—å–æ–≥–æ –Ω–µ–º–∞—î –∂–æ–¥–Ω–∏—Ö –ø—Ä–∞–≤**.  

–©–æ–± –≤–∏–¥–∞—Ç–∏ –π–æ–º—É –ø—Ä–∞–≤–∞, –≤–∏–∫–æ–Ω–∞–π –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ RabbitMQ:

```sh
docker exec -it rabbitmq rabbitmqctl add_user client1 ""
docker exec -it rabbitmq rabbitmqctl set_user_tags client1 administrator
```

> **–ü—Ä–∏–º—ñ—Ç–∫–∞:**  
> –Ø–∫—â–æ RabbitMQ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—ñ–ª—å–∫–∏ **TLS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é** (`auth_mechanisms.1 = external`), —Ç–æ –ø–∞—Ä–æ–ª—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `client1` –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è (–π–æ–≥–æ –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –ø—É—Å—Ç–∏–º).

---

# üîπ 2. –î–æ–∑–≤—ñ–ª –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö —á–µ—Ä–≥  
–¢–µ–ø–µ—Ä —Ç—Ä–µ–±–∞ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ `client1` –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö —á–µ—Ä–≥ —Ç–∞ –æ–±–º—ñ–Ω–Ω–∏–∫—ñ–≤:

```sh
docker exec -it rabbitmq rabbitmqctl set_permissions -p / client1 ".*" ".*" ".*"
```

–¶–µ –æ–∑–Ω–∞—á–∞—î:  
- **"read" (—á–∏—Ç–∞–π):** `.*` ‚Äì –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ —á–∏—Ç–∞—Ç–∏ –≤—Å—ñ —á–µ—Ä–≥–∏  
- **"write" (–ø–∏—à–∏):** `.*` ‚Äì –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ –ø–∏—Å–∞—Ç–∏ –≤ —É—Å—ñ —á–µ—Ä–≥–∏  
- **"configure" (–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è):** `.*` ‚Äì –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —á–µ—Ä–≥–∏  

–¢–µ–ø–µ—Ä `client1` –º–æ–∂–µ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ RabbitMQ —á–µ—Ä–µ–∑ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏** –±–µ–∑ –ø–∞—Ä–æ–ª—è.

---

# üîπ 3. –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —á–µ—Ä–≥  
–©–æ–± –¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –¥–æ **–ø–µ–≤–Ω–æ—ó —á–µ—Ä–≥–∏**, –∑–∞–º—ñ—Å—Ç—å `.*` –≤–∫–∞–∂–∏ —ó—ó –Ω–∞–∑–≤—É:  

```sh
docker exec -it rabbitmq rabbitmqctl set_permissions -p / client1 "^my_queue$" "^my_queue$" "^my_queue$"
```

–¢–µ–ø–µ—Ä `client1` –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ **—á–µ—Ä–≥–æ—é `my_queue`**, –∞–ª–µ –Ω–µ –∑ —ñ–Ω—à–∏–º–∏.

---

# üîπ 4. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫ (policies)  
–ü–æ–ª—ñ—Ç–∏–∫–∏ –≤ RabbitMQ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∫–µ—Ä—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —á–µ—Ä–≥, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
- TTL –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —á–µ—Ä–≥–∏
- –î—É–±–ª—ñ–∫–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –º—ñ–∂ –Ω–æ–¥–∞–º–∏

–©–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫—É –¥–ª—è –≤—Å—ñ—Ö —á–µ—Ä–≥, —â–æ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –Ω–∞ `"logs_"`, –≤–∏–∫–æ–Ω–∞–π:

```sh
docker exec -it rabbitmq rabbitmqctl set_policy my_policy "^logs_.*" '{"max-length":10}' --apply-to queues
```

–¶–µ –æ–∑–Ω–∞—á–∞—î:
- –í—Å—ñ —á–µ—Ä–≥–∏, —â–æ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –Ω–∞ `"logs_"`, –∑–º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ **–Ω–µ –±—ñ–ª—å—à–µ 10 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å**  
- –ü–æ–ª—ñ—Ç–∏–∫–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è **–¥–æ –≤—Å—ñ—Ö —á–µ—Ä–≥ (`--apply-to queues`)**  

---

# üîπ 5. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –∫–ª—ñ—î–Ω—Ç–∞  
–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫—ñ –ø—Ä–∞–≤–∞ –º–∞—î –∫–ª—ñ—î–Ω—Ç, –∑–∞–ø—É—Å—Ç–∏:

```sh
docker exec -it rabbitmq rabbitmqctl list_user_permissions client1
```

–û—Ç—Ä–∏–º–∞—î—à —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫:

```
/  ^my_queue$  ^my_queue$  ^my_queue$
```

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ `client1` –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ `my_queue`.

---

# ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫  
- **RabbitMQ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —ñ–º'—è –∫–ª—ñ—î–Ω—Ç–∞** —á–µ—Ä–µ–∑ **CN —É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ**  
- **–ê–ª–µ –¥–æ—Å—Ç—É–ø –¥–æ —á–µ—Ä–≥ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ `set_permissions`**  
- **–ú–æ–∂–Ω–∞ –æ–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–µ–≤–Ω–∏—Ö —á–µ—Ä–≥** –∞–±–æ **–∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏**  

–¢–µ–ø–µ—Ä —Ç–≤—ñ–π RabbitMQ –∑–∞—Ö–∏—â–µ–Ω–∏–π —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π! üîíüöÄ